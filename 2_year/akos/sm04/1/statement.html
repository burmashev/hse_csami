<html><head><meta charset="utf-8"/></head>
<body>
<table border="1"><tr><td><b>Time limit:</b></td><td><tt>1 s</tt></td></tr>
<tr><td><b>Real time limit:</b></td><td><tt>5 s</tt></td></tr>
<tr><td><b>Memory limit:</b></td><td><tt>64M</tt></td></tr>
</table>
<h3>Problem sm04-1: asm/mem/malloc</h3>
<p>Напишите подпрограмму <code>alloc_mem</code>, которая аллоцирует память на куче.</p>
<p>Подпрограмма <code>alloc_mem</code>:</p>
<ul>
<li>принимает один параметр <code>size</code> (32-битное беззнаковое число) —
        минимальный размер (в байтах) блока памяти,
        который нужно аллоцировать;</li>
<li>возвращает адрес блока памяти не менее чем требуемого размера либо 0.</li>
</ul>
<p>В тестирующей программе будет определена глобальная переменная <code>freelist</code>, в которой
        хранится список свободных блоков памяти:</p>
<p><img src="https://caos.myltsev.ru/cgi-bin/new-client?SID=df6483329ace2507&amp;prob_id=16&amp;action=194&amp;file=image.png"/></p>
<p>В каждом блоке первое машинное слово — размер блока в байтах минус 4, второе — адрес следующего блока
        в списке. Если в списке есть блоки, у которых записанный размер не меньше size, <code>alloc_mem</code>
        должна удалить первый такой блок из списка и вернуть вызывающей подпрограмме адрес тела этого блока
        (адрес блока, увеличенный на 4).</p>
<p>Если в списке <code>freelist</code> подходящих блоков нет, то <code>alloc_mem</code> использует
        системный вызов <code>brk</code>, чтобы запросить у системы <code>4 + actual_size</code> байт
        дополнительной памяти. <code>actual_size</code> вычисляется как <code>max(4, align4(size))</code>,
        где align4 – операция округления вверх до числа, кратного 4.</p>
<p>Пример работы с системным вызовом
        <code>brk</code> приводился на лекции.
        Если <code>brk</code> отработал успешно, то <code>alloc_mem</code> записывает
        <code>actual_size</code> в первое машинное слово полученного участка памяти
        и возвращает адрес второго машинного слова.</p>
<p>В случае, если выделить память не удалось (результат <code>brk</code>
        не совпадает с его аргументом), <code>alloc_mem</code> должна вернуть 0. При этом подпрограмма
        <code>alloc_mem</code> должна остаться работоспособной (иметь возможность в дальнейшем выделить
        меньший объём памяти, если это возможно).</p>
</body></html>